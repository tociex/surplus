@model IEnumerable<pengambilan.Models.Pengambilan>

@{
    ViewData["Title"] = "Material Surplus";
}


<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>
    thead input {
        width: 100%;
    }


</style>
<div class="container">

    <h3>Material Surplus</h3>

    <a asp-action="Create" class="btn btn-success"style="color:white"><i class="glyphicon glyphicon-plus"></i> Add Material</a>
    <a asp-action="Index" class="btn btn-default"><i class="glyphicon glyphicon-refresh"></i> Reload</a>
  
  
  <br/>
    <br/>
    <div class="row">
        <div class="table-responsive">

                <table id="example" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                           
                            <th>
                                Tglinput
                            </th>
                            <th>
                                Source material
                            </th>
                            <th>
                                Material_no
                            </th>
                            <th>
                                Old material
                            </th>
                            <th>
                                Short desc
                            </th>
                            <th>
                                Description
                            </th>
                            <th>
                                Qty
                            </th>
                             <th>
                               Qty Terambil
                            </th>
                            <th>
                               Qty Sisa
                            </th>
                            <th>
                                Unit Price
                            </th>
                             <th>
                                Value
                            </th>
                            <th>
                                Uom
                            </th>
                            <th>
                                Posisi
                            </th>
                            <th>
                                Luas
                            </th>
                            <th>
                                Sloc
                            </th>
                            <th>
                                Sbin
                            </th>
                            <th>
                                File_foto
                            </th>
                            <th style="width:100px">Aksi </th>
                                        
                        </tr>
                    </thead>
                    <tbody>
                       @foreach (var item in  ViewBag.Materialssurplus) {
                           
                              var sumTotalWeight = 0;
                               foreach (var item2 in Model.Where(s => s.Material_no == item.Material_no).ToList())
                                {                
                                       
                                        sumTotalWeight += int.Parse(item2.Qty);
                                       
                                }   
                                
                                var sum = (int.Parse(item.Qty) - sumTotalWeight);
  
                                var result = (int.Parse(item.Nilai) * sum);
  
                                <tr>
                                  
                                    <td>
                                        @item.Tgl_input
                                    </td>
                                    <td>
                                        @item.Source_material
                                    </td>
                                    <td>
                                        @item.Material_no
                                    </td>
                                    <td>
                                        @item.Old_material
                                    </td>
                                    <td>
                                        @item.Short_desc
                                    </td>
                                    <td>
                                        @item.Description
                                    </td>
                                    <td>
                                        @item.Qty
                                    </td>
                                    <td>@sumTotalWeight
                                        @* @Html.DisplayFor(modelItem => item.Qty) *@
                                    </td>
                                    <td>
                                        @sum
                                    </td>
                                    <td> <span class='format'> @item.Nilai</span>
  
                                    </td>

                                     <td> <span class='format'> @result</span>
  
                                    </td>
                                    <td>
                                        @item.Uom
                                    </td>
                                    <td>
                                        @item.Posisi
                                    </td>
                                    <td>
                                        @item.Luas
                                    </td>
                                    <td>
                                        @item.Sloc
                                    </td>
                                    <td>
                                        @item.Sbin
                                    </td>
                                    <td><center>
                                    @if (string.IsNullOrEmpty(item.File_foto)) {

                                        <img src="~/images/blank_photo.png"   
                                        class="rounded-circle"   
                                        height="40" width="40"   
                                        asp-append-version="true" /> 
   
                                    }else{
                                        <img src="~/images/@item.File_foto"   
                                        class="rounded-circle"   
                                        height="40" width="40"   
                                        asp-append-version="true" /> 
                                    }
                                    </center></td>
                                    <td>
                                        <a asp-action="Edit" asp-route-id="@item.Id"  class="btn btn-sm btn-primary" style="color:white"><i class="glyphicon glyphicon-pencil"></i></a> 
                                        <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-success"><i class="glyphicon glyphicon-eye-open"></i></a>
                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger"><i class="glyphicon glyphicon-trash"></i></a>
                                    </td>
                                 
                                     
                                </tr>

                               
                        }
                       
                             
                    </tbody>
                
                </table>
        </div>
	</div>
</div>
<script type="text/javascript">
		function addCommas(nStr)
    {
       nStr += '';
       x = nStr.split('.');
       x1 = x[0];
       x2 = x.length > 1 ? '.' + x[1] : '';
       var rgx = /(\d+)(\d{3})/;
       while (rgx.test(x1)) {
          x1 = x1.replace(rgx, '$1' + ',' + '$2');
       }
       return x1 + x2;
    }

$(function(){
   $(".format").each(function(c, obj){
      $(obj).text('Rp. ' + addCommas(parseFloat($(obj).text()).toFixed(2)));
   });
});
	</script>
<script>
   $(document).ready(function() {
    // Setup - add a text input to each footer cell
    $('#example thead tr').clone(true).appendTo( '#example thead' );
    $('#example thead tr:eq(1) th').each( function (i) {
        var title = $(this).text();
        $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
 
        $( 'input', this ).on( 'keyup change', function () {
            if ( table.column(i).search() !== this.value ) {
                table
                    .column(i)
                    .search( this.value )
                    .draw();
            }
        } );
    } );
 
    var table = $('#example').DataTable( {
        orderCellsTop: true,
        fixedHeader: true
    } );
} );
</script>

